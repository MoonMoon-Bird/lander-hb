;(self.SPZ=self.SPZ||[]).push({n:"spz-render",ev:"0.1",l:!0,t:"v1",v:"1.0",m:0,f:function(t,n){!function(){var n;function i(){return n||(n=Promise.resolve(void 0))}var r,e,u="[a-zA-Z_][\\w\\-\\.]*",o="((?:"+u+"\\:)?"+u+")",l=[/"([^"]*)"+/.source,/'([^']*)'+/.source,/([^\s"'=<>`]+)/.source],s=new RegExp("^<"+o),f=new RegExp("^<\\/"+o+"[^>]*>"),a=/^\s*(\/?)>/,c=/\{\{((?:.|\n)+?)\}\}/g,v=new RegExp("^\\s*"+/([^\s"'<>/=]+)/.source+"(?:\\s*("+/(?:=)/.source+")\\s*(?:"+l.join("|")+"))?"),h=[],d=0,y="";function p(t,n){return d+=t,n.substring(t)}function S(t){for(var n={},i=0,r=t.length;i<r;i++)n[t[i].name]=t[i].value;return n}function b(t){var n=t.match(s);if(n){var i,r,e={tagName:n[1],attrs:[],start:d};for(t=p(n[0].length,t);!(i=t.match(a))&&(r=t.match(v));)t=p(r[0].length,t),e.attrs.push({name:r[1],value:r[3]});if(i)return e.unarySlash=i[1],t=p(i[0].length,t),e.end=d,{match:e,string:t}}return{match:{},string:t}}function m(t){var n;for(n=h.length-1;n>=0&&h[n].lowerCasedTag!==t.toLowerCase();n--);n>=0&&(r=n>0?h[n-1]:null,h.length=n)}function P(t){if(c.test(t)){for(var n,i,r=[],e=c.lastIndex=0;n=c.exec(t);){(i=n.index)>e&&r.push(JSON.stringify(t.slice(e,i)));var u=n[1].trim();r.push("_s(".concat(u,")")),e=i+n[0].length}return e<t.length&&r.push(JSON.stringify(t.slice(e))),r.join("+")}}function g(t){return self.document.createTextNode(_(t))}function k(t,n,i){null==t||t.insertBefore(n,i)}function Z(t,n){null==t||t.appendChild(n)}function w(t){return null==t?void 0:t.parentNode}function O(t,n){t&&(t.textContent=_(n))}function C(n,i,r){var e,u=null,o=[];Object.keys((null==i?void 0:i.attrsMap)||{}).forEach((function(t){o.push({name:t,value:null==i?void 0:i.attrsMap[t]})})),o.forEach((function(t){var i=t.name,r=t.value,e=null==n?void 0:n.getAttribute(i);if(e!==r)if(i.includes("@")){var o=i.replace("@","on:");(null==n?void 0:n.getAttributeNode(i))||null!=n&&n.hasAttribute(o)?n.getAttributeNode(i)&&(n.getAttributeNode(i).value=r):null==n||n.setAttribute(o,r),null==n||n.setAttribute("eventChange","")}else if("class"==i&&(null!=n&&n.tagName.startsWith("SPZ-")||null!=n&&n.tagName.startsWith("LJS-"))&&e&&e.includes("i-spzhtml-")){var l=e.split(" ").filter((function(t){return t.startsWith("i-spzhtml-")})).join(" ");null==n||n.setAttribute(i,"".concat(r," ").concat(l))}else i.includes("on:")?e&&r&&(null==n||n.setAttribute(i,r)):null==n||n.setAttribute(i,r);e&&((u=u||{})[i]=r)})),u&&!r&&((e=n.tagName).startsWith("SPZ-")||e.startsWith("LJS-"))&&t.whenApiDefined(n).then((function(t){t.mutatedAttributesCallback(u)}))}function _(t){return"string"==typeof t?t.replace(/&lt;|&gt;|&amp;|&quot;|&#39;|&#x60;/g,(function(t){return{"&lt;":"<","&gt;":">","&amp;":"&","&quot;":'"',"&#39;":"'","&#x60;":"`"}[t]})):t}function x(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}var J=function t(n,i,r,e){var u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};x(this,t),this.tag=n,this.children=i,this.text=r,this.elm=e,this.isCloned=!1,this.attrsList=u?JSON.parse(JSON.stringify(u)):[],this.attrsMap=JSON.parse(JSON.stringify(o))};function j(t){var n,i=new J(t.tag,t.children&&t.children.slice(),t.text,t.elm,t.attrsList,t.attrsMap);return i.key=null===(n=t.attrsMap)||void 0===n?void 0:n.key,i.isCloned=!0,i}function N(t){return(N="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function z(t,n,i,r,e){var u,o,l,s;if((null==t||null===(u=t.elm)||void 0===u?void 0:u.outerHTML)!==(null===(o=n)||void 0===o||null===(l=o.elm)||void 0===l?void 0:l.outerHTML)||(null==t?void 0:t.text)!==(null===(s=n)||void 0===s?void 0:s.text)||JSON.stringify(t.attrsMap||{})!==JSON.stringify(n.attrsMap)){var f;M(n.elm)&&M(r)&&(n=r[e]=j(n)),f=t.elm?n.elm=t.elm:t.elm=n.elm;var a=t.children,c=n.children;I(n.text)?M(a)&&M(c)?a!==c&&function(t,n,i,r){for(var e,u,o,l,s=0,f=0,a=n.length-1,c=n[0],v=n[a],h=i.length-1,d=i[0],y=i[h];s<=a&&f<=h;)I(c)?c=n[++s]:I(v)?v=n[--a]:F(c,d)?(z(c,d,r,i,f),c=n[++s],d=i[++f]):F(v,y)?(z(v,y,r,i,h),v=n[--a],y=i[--h]):F(c,y)?(z(c,y,r,i,h),k(t,c.elm,null==(l=v.elm)?void 0:l.nextSibling),c=n[++s],y=i[--h]):F(v,d)?(z(v,d,r,i,f),k(t,v.elm,c.elm),v=n[--a],d=i[++f]):(I(e)&&(e=B(n,s,a)),I(u=M(d.key)?e[d.key]:U(d,n,s,a))?R(d,r,t,c.elm,!1,i,f):F(o=n[u],d)?(z(o,d,r,i,f),n[u]=void 0,k(t,o.elm,c.elm)):R(d,r,t,c.elm,!1,i,f),d=i[++f]);s>a?L(t,I(i[h+1])?null:i[h+1].elm,i,f,h,r):f>h&&A(n,s,a)}(f,a,c,i):M(c)?(M(t.text)&&O(f,""),L(f,null,c,0,c.length-1,i)):M(a)?A(a,0,a.length-1):M(t.text)&&O(f,""):t.text!==n.text&&O(f,n.text),JSON.stringify(t.attrsMap||{})!==JSON.stringify(n.attrsMap)&&f&&C(f,n)}else n.elm=t.elm}function E(t){var n,i,r=w(t);M(r)&&(i=t,null==(n=r)||n.removeChild(i))}function R(t,n,i,r,e,u,o){M(t.elm)&&M(u)&&(t=u[o]=j(t)),t.isRootInsert=!e;var l,s=t,f=s.children,a=s.tag;if("svg"==a)return D(t,f,n),void T(i,t.elm,r);M(a)?(t.elm=function(t,n){var i,r=self.document.createElement(t);return null!==(i=n.attrsList)&&void 0!==i&&i.length?(C(r,n,"add"),r):r}(a,t),D(t,f,n),T(i,t.elm,r)):!0===t.isComment?(t.elm=(l=t.text,self.document.createComment(l)),T(i,t.elm,r)):(t.elm=g(t.text),T(i,t.elm,r))}function T(t,n,i){M(t)&&(M(i)?w(i)===t&&k(t,n,i):Z(t,n))}function D(t,n,i){if(Array.isArray(n))for(var r=0;r<n.length;++r)R(n[r],i,t.elm,null,!0,n,r);else("string"==typeof(e=t.text)||"number"==typeof e||"symbol"===N(e)||"boolean"==typeof e)&&Z(t.elm,g(String(t.text)));var e}function L(t,n,i,r,e,u){for(;r<=e;++r)R(i[r],u,t,n,!1,i,r)}function A(t,n,i){for(;n<=i;++n){var r=t[n];M(r)&&(M(r.tag)?(e=r,M(void 0)?undefined():E(e.elm)):E(r.elm))}var e}function U(t,n,i,r){for(var e=i;e<r;e++){var u=n[e];if(M(u)&&F(t,u))return e}}function F(t,n){var i,r;return(null===(i=t.attrsMap)||void 0===i?void 0:i.key)===(null===(r=n.attrsMap)||void 0===r?void 0:r.key)&&t.tag===n.tag&&function(t,n){var i,r;if("input"!==t.tag)return!0;var e=null===(i=t.attrsMap)||void 0===i?void 0:i.type,u=null===(r=n.attrsMap)||void 0===r?void 0:r.type;return e===u||H(e)&&H(u)}(t,n)}function q(t){return function t(n){var i,r=n.elm;return r&&null!==(i=n.children)&&void 0!==i&&i.length?(n.children.filter((function(t){return!!(3!=t.nodeType&&t.nodeType||""!=t.text&&" "!=t.text)})).forEach((function(n,i){n.elm=r.children[i],t(n)})),n.children.forEach((function(n,i){n.elm||(n.elm=r.childNodes[i],t(n))})),n):n}(t)}function B(t,n,i){var r,e,u={};for(r=n;r<=i;++r)M(e=t[r].key)&&(u[e]=r);return u}function M(t){return null!=t}function H(t){"text,number,password,search,email,tel,url".split(",").includes(t)}function I(t){return null==t}function W(t){return(W="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function G(t,n){return(G=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}function K(t,n){if(n&&("object"===W(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Q(t){return(Q=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var V=function(n){!function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),n&&G(t,n)}(v,n);var u,o,l,a,c=(l=v,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,n=Q(l);if(a){var i=Q(this).constructor;t=Reflect.construct(n,arguments,i)}else t=n.apply(this,arguments);return K(this,t)});function v(t){var n;return function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,v),(n=c.call(this,t)).templates_=void 0,n.container_=void 0,n.manualContainer_=void 0,n.lastVnode_=void 0,n.manual_=!1,n.animate_=!1,n.isMultipleSrc_=!1,n.isFirstRender_=!0,n}return u=v,(o=[{key:"buildCallback",value:function(){this.action_=SPZServices.actionServiceForDoc(this.element),this.container_=SPZCore.Dom.scopedQuerySelector(this.element,":first-child:not(template)"),this.container_&&(this.manualContainer_=this.container_.cloneNode(!0),this.element.appendChild(this.container_)),this.templates_=SPZServices.templatesForDoc(this.element),this.manual_=this.element.hasAttribute("manual"),this.animate_=this.element.hasAttribute("animate"),this.animate_&&this.element.hasAttribute("duration")&&(this.animateDuration_=parseInt(this.assert(this.element.hasAttribute("duration"),"duration should be number of ms"),10)),this.setupAction_()}},{key:"mountCallback",value:function(){return this.manual_?(this.container_&&this.setElementHeight_(),i()):this.loadData_()}},{key:"unmountCallback",value:function(){this.container_&&this.container_.remove(),this.lastVnode_=void 0,this.container_=null,this.manualContainer_=null}},{key:"render",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return n&&this.unmountCallback(),this.redo_=n,t?this.doRender_(t):this.loadData_()}},{key:"setupAction_",value:function(){var t=this;this.registerAction("render",(function(n){var i,r,e=null==n||null===(i=n.args)||void 0===i?void 0:i.src;e&&t.element.setAttribute("src",e),1==(null==n||null===(r=n.args)||void 0===r?void 0:r.redo)&&t.unmountCallback(),t.render()})),this.registerAction("rerender",(function(n){var i,r,e;1!=(null==n||null===(i=n.args)||void 0===i?void 0:i.once)||t.isFirstRender_?(1==(null==n||null===(r=n.args)||void 0===r?void 0:r.redo)&&t.unmountCallback(),t.doRender_(null==n||null===(e=n.args)||void 0===e?void 0:e.data)):t.fireEvent_("afterOnceFinish")}))}},{key:"setElementHeight_",value:function(t){if(t)return this.initHeight_=!0,void SPZCore.Dom.setStyles(this.element,{height:t});var n=this.element.clientHeight;n&&SPZCore.Dom.setStyles(this.element,{height:"".concat(n,"px")})}},{key:"loadData_",value:function(){var t=this;return this.show(),this.setLoadingStatus_(!0),this.fetchData_().then((function(n){return t.doRender_(t.parseData_(n))})).catch((function(n){n&&n.then&&n.then((function(n){if(null!=n&&n.message||null!=n&&n.errors){var i="error",r=SPZUtils.Event.create(t.win,"spz-render.".concat(i),{data:n});t.action_.trigger(t.element,i,r)}}))})).finally((function(){t.setLoadingStatus_(!1),t.hide()}))}},{key:"fetchData_",value:function(){var t=this;if(!this.element.hasAttribute("src"))return Promise.resolve({});var n=this.handleSrc_(),i=function(n){if(n.startsWith("script:")){t.assert(n.length>7,"script id invalidated.");var i=n.slice(7);return Promise.resolve(t.fetchFromScript(i))}return n.startsWith("spz-script:")?t.getSpzScriptJson_(n):SPZServices.batchedXhrFor(t.win).batchFetchJsonFor(t.element,{url:n})};return this.isMultipleSrc_?Promise.all(n.map((function(t){return i(t)}))):i(n)}},{key:"handleSrc_",value:function(){var t=this.element.getAttribute("src").split(";").filter((function(t){return t}));return this.isMultipleSrc_=t.length>1,this.isMultipleSrc_?t:t[0]}},{key:"fetchFromScript",value:function(t){if(t){var n=this.element.ownerDocument.getElementById(t),i=this.assert(n,"can not find script tag with id: .%s",t).textContent;if(i)return JSON.parse(i)}}},{key:"getSpzScriptJson_",value:function(t){var n=this;return i().then((function(){return SPZServices.scriptForDocOrNull(n.element).then((function(n){return n.fetch(t)}))})).then((function(t){return t}))}},{key:"doRender_",value:function(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.renderItem_=n,this.setEmptyStatus_(),!this.templates_.hasTemplate(this.element))return this.fireEvent_("finish"),i();var r=function(){return t.templates_.findAndRenderTemplate(t.element,n,null,"vnode").then((function(n){var i=n.el,r=n.vnode;t.handleDiffDom_(i,r),t.setMinWidth_()}))};return r().then((function(){t.isFirstRender_=!1,t.fireEvent_("finish")}))}},{key:"handleDiffDom_",value:function(t,n){if(n.elm=t,!this.lastVnode_&&!this.manualContainer_&&!this.container_||this.redo_)return this.redo_&&(this.container_||this.lastVnode_||this.manualContainer_)&&this.clear_(),this.element.appendChild(t),this.lastVnode_=n,void(this.container_=t);var i=this.manualContainer_||this.container_;!this.lastVnode_&&i&&(this.lastVnode_=function(t){for(h=[],r=null,e=null,d=0,y="",t=t.replace(/\s+/g," ");t&&" "!==t;){var n=t.indexOf("<");if(0===n){var i=t.match(f);if(i)t=p(i[0].length,t),m(i[1]);else if(t.match(s)){var u,o=b(t),l=o.match;t=o.string;var a=l,c={nodeType:1,tag:a.tagName,lowerCasedTag:null==a||null===(u=a.tagName)||void 0===u?void 0:u.toLowerCase(),attrsList:a.attrs,attrsMap:S(a.attrs||[]),parent:r,children:[]};if(void 0,(w=function(t,n){var i;if(t.attrsMap&&null!=(i=t.attrsMap[n]))for(var r=t.attrsList,e=0,u=r.length;e<u;e++)if(r[e].name===n){r.splice(e,1);break}return i}(Z=c,"spz-if"))&&(Z.if=w,Z.ifConditions||(Z.ifConditions=[]),Z.ifConditions.push({exp:w,block:Z})),e||(e=c),r){var v=r.children.filter((function(t){return!(3===t.nodeType&&" "===t.text)})),g=(null==c?void 0:c.attrsMap.hasOwnProperty("spz-else"))&&"true"==v[v.length-1].if||"false"==c.if;"true"==c.if?r.children.push(c):g?r.children.push({nodeType:"3",text:""}):g||r.children.push(c)}a.unarySlash||(h.push(c),r=c)}else t=p(1,t)}else{var k;y=t.substring(0,n),t=p(n,t),(k=P(y))?r&&r.children.push({nodeType:2,text:y,expression:k}):r&&r.children.push({nodeType:3,text:y})}}var Z,w;return e}(i.outerHTML),this.lastVnode_.elm=this.container_);var u=function(t,n){return z(q(t),q(n),[],null,null),n.elm}(this.lastVnode_,n);this.container_=u,n.elm=u,this.lastVnode_=n,this.attemptToFit_()}},{key:"clear_",value:function(){this.container_&&this.container_.remove(),this.lastVnode_=void 0,this.container_=null,this.manualContainer_=null}},{key:"attemptToFit_",value:function(){var n=this;if(!this.initHeight_){var i=function(){n.mutateElement((function(){return n.setElementHeight_("auto")}))};if(this.container_){var r=this.container_.querySelectorAll("*:not(template)");return Array.prototype.filter.call(r,SPZUtils.isSpzElement).filter((function(t){return!(t.isMount&&t.isMount())})).map((function(n){return t.whenDefined(n).then((function(){return n.whenMounted()}))})).forEach((function(t){return t.then((function(){return i()}))}))}return i()}}},{key:"setMinWidth_",value:function(){var t,n=SPZServices.platformFor(this.win),i=n.isIos(),r=n.isSafari();if(i||r){var e=null===(t=this.container_)||void 0===t?void 0:t.scrollWidth;this.element.offsetWidth!==e&&SPZCore.Dom.setStyles(this.element,{"min-width":"".concat(e,"px")})}}},{key:"fireEvent_",value:function(t){var n=SPZUtils.Event.create(this.win,SPZCore.SpzEvents.DOM_UPDATE,{"data":this.renderItem_},{bubbles:!0}),i=SPZUtils.Event.create(this.win,"spz-render.".concat(t),{"data":this.renderItem_});this.action_.trigger(this.element,t,i,{bubbles:!1}),this.element.dispatchEvent(n)}},{key:"setEmptyStatus_",value:function(){SPZCore.Dom.toggleAttribute(this.element,"data-empty",!this.renderItem_||(SPZCore.Types.isArray(this.renderItem_)?!this.renderItem_.length:SPZCore.Types.isEmptyObject(this.renderItem_)))}},{key:"setLoadingStatus_",value:function(t){SPZCore.Dom.toggleAttribute(this.element,"loading",t),SPZCore.Dom.toggleAttribute(this.element,"finish",!t)}},{key:"parseData_",value:function(t){if(!this.isMultipleSrc_)return t;var n={};return null==t||t.filter((function(t){return SPZCore.Types.isArray(t)?t.length:!SPZCore.Types.isEmptyObject(t)})).forEach((function(t,i){n[i]=t})),n}},{key:"getData",value:function(){return this.renderItem_}},{key:"isLayoutSupported",value:function(t){return t==SPZCore.Layout.CONTAINER}}])&&function(t,n){for(var i=0;i<n.length;i++){var r=n[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(u.prototype,o),Object.defineProperty(u,"prototype",{writable:!1}),v}(t.BaseElement);self.SPZ.registerElement("spz-render",V)}()}});